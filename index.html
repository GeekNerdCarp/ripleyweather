<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Ripley Weather â€¢ Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --navy:#003b6f; --red:#b30000; --white:#ffffff;
    --bg:#f0f6ff; --text:#001f33;
    --panel:#e4ecf7; --border:#ccd9eb;
    --accent:#005bbb;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:"Trebuchet MS",Verdana,Arial,sans-serif}
  header.mast{background:linear-gradient(to right,var(--navy),#005bbb);color:#fff;padding:10px 16px;display:flex;justify-content:space-between;align-items:center}
  .brand{display:flex;align-items:center;gap:12px;font-weight:800;text-transform:uppercase}
  .logo{width:36px;height:36px;border-radius:6px;background:var(--red);display:grid;place-items:center;color:#fff;font-weight:900}
  .controls{display:flex;align-items:center;gap:10px}
  .btn,.select{padding:6px 10px;border:1px solid var(--border);border-radius:4px;background:#fff;cursor:pointer}
  .stamp{font-size:.85rem;opacity:.85}
  .wrap{display:flex}
  nav.toc{width:240px;padding:12px;background:#eef4fc;border-right:2px solid var(--border)}
  nav.toc h3{margin:12px 4px;font-size:.85rem;color:#005bbb;text-transform:uppercase}
  nav.toc a{display:block;padding:6px 8px;margin:3px 0;color:#003b6f;text-decoration:none;border-radius:4px}
  nav.toc a:hover{background:#dbe9ff}
  main.content{flex:1;padding:16px}
  section.card{background:#fff;border:2px solid var(--border);margin:14px 0;padding:12px;border-radius:6px}
  .bar{font-weight:700;margin-bottom:8px;padding:6px 8px;background:#005bbb;color:#fff;border-radius:4px}
  footer{margin-top:2rem;padding:1rem;border-top:2px solid var(--border);font-size:.85rem;text-align:center;color:#333}
  footer ul{list-style:none;padding:0;margin:0;line-height:1.6}
  a{color:var(--accent)}
  /* Severe banner (unchanged) */
  @keyframes flashBorder{0%{border-color:#ff0000}50%{border-color:#ffb703}100%{border-color:#ff0000}}
  .banner{display:none;margin:10px 0;padding:12px 16px;border-radius:10px;font-weight:900;font-size:1.1rem;text-align:center;background:#fff3e0;color:#7a3d00;border:4px solid #ff0000;position:relative}
  body.theme-severe .banner{display:block;animation:flashBorder 1.2s infinite}
  .banner button.dismiss{position:absolute;top:4px;right:8px;border:none;background:transparent;font-size:1rem;font-weight:bold;cursor:pointer;color:#7a3d00}
</style>
</head>
<body>
  <header class="mast">
    <div class="brand">
      <div class="logo">WX</div>
      <h1>Ripley Weather <small style="font-weight:400">â€¢ Local Outlook</small></h1>
    </div>
    <div class="controls">
      <button id="refreshBtn" class="btn">â†» Refresh</button>
      <div id="runStamp" class="stamp">Loadingâ€¦</div>
    </div>
  </header>

  <div class="wrap">
    <nav class="toc">
      <h3>Forecast</h3>
      <a href="#quick">ğŸ” Quick Look</a>
      <a href="#cards">ğŸ“‹ Key Cards</a>
      <a href="#seven">ğŸ“† 7-Day</a>
      <a href="#dayplanner">ğŸ•’ 24-Hour Planner</a>
      <h3>Storm Outlook</h3>
      <a href="#trends">ğŸ“ˆ Trends & Diagnostics</a>
      <a href="#severe">â›ˆ Severe Weather</a>
      <a href="#radar">ğŸ›° Radar & Satellite</a>
      <a href="#lightning">âš¡ Lightning</a>
      <h3>Impacts</h3>
      <a href="#alerts">âš ï¸ Alerts</a>
      <a href="#health">ğŸŒ¬ Air & Health</a>
      <a href="#local">ğŸ« Local Impacts</a>
      <a href="#rivers">ğŸŒŠ Rivers & Streams</a>
      <h3>Climate & Sky</h3>
      <a href="#records">ğŸ“Š Climatology</a>
      <a href="#astro">ğŸŒŒ Astronomy</a>
      <h3>Summary</h3>
      <a href="#bottom">âœ… Bottom Line</a>
    </nav>

    <main class="content">
      <div id="sevBanner" class="banner">âš ï¸ Severe Weather Currently in the Area âš ï¸ <button class="dismiss" onclick="dismissBanner()">Ã—</button></div>

      <h2 id="runTitle">Ripley Weather</h2>

      <section id="quick" class="card"><div class="bar">ğŸ” Quick Look</div><div id="quickHtml">Loadingâ€¦</div></section>
      <section id="cards" class="card"><div class="bar">ğŸ“‹ Key Items</div><div id="cardsHtml">Loadingâ€¦</div></section>
      <section id="seven" class="card"><div class="bar">ğŸ“† 7-Day Outlook</div><div id="sevenHtml">Loadingâ€¦</div></section>
      <section id="dayplanner" class="card"><div class="bar">ğŸ•’ 24-Hour Planner</div><div id="plannerHtml">Loadingâ€¦</div></section>
      <section id="trends" class="card"><div class="bar">ğŸ“ˆ Trends & Diagnostics</div><div id="trendsHtml">Loadingâ€¦</div></section>
      <section id="severe" class="card"><div class="bar">â›ˆ Severe Weather Diagnostics</div><div id="severeHtml">Loadingâ€¦</div></section>
      <section id="radar" class="card"><div class="bar">ğŸ›° Radar & Satellite</div><div id="radarHtml">Loadingâ€¦</div></section>
      <section id="lightning" class="card"><div class="bar">âš¡ Lightning Summary</div><div id="lightningHtml">Loadingâ€¦</div></section>
      <section id="alerts" class="card"><div class="bar">âš ï¸ Alerts & Hazards</div><div id="alertsHtml">Loadingâ€¦</div></section>
      <section id="health" class="card"><div class="bar">ğŸŒ¬ Air & Health</div><div id="airHtml">Loadingâ€¦</div></section>
      <section id="local" class="card"><div class="bar">ğŸ« Local Impacts</div><div id="localHtml">Loadingâ€¦</div></section>
      <section id="rivers" class="card"><div class="bar">ğŸŒŠ Rivers & Streams</div><div id="riversHtml">Loadingâ€¦</div></section>
      <section id="records" class="card"><div class="bar">ğŸ“Š Climatology & Records</div><div id="recordsHtml">Loadingâ€¦</div></section>
      <section id="astro" class="card"><div class="bar">ğŸŒŒ Astronomy & Skywatch</div><div id="astroHtml">Loadingâ€¦</div></section>
      <section id="bottom" class="card"><div class="bar">âœ… Bottom Line</div><div id="bottomHtml">Loadingâ€¦</div></section>
    </main>
  </div>

  <footer>
    <p><strong>Created by Matthew Carpenter</strong> â€” <a href="mailto:matthew@carpsemail.com">matthew@carpsemail.com</a></p>
    <p><em>Data Sources:</em></p>
    <ul>
      <li>ğŸŒ NOAA / NWS ILN â€” 7-Day Forecast, Alerts, AFD</li>
      <li>ğŸŒ¤ï¸ Open-Meteo â€” Forecast & Astronomy</li>
      <li>ğŸ›°ï¸ NOAA/NWS â€” Radar, Satellite</li>
      <li>âš¡ LightningMaps.org â€” Real-time Lightning</li>
      <li>ğŸŒ¬ AirNow â€” AQI</li>
    </ul>
    <p id="lastUpdated"></p>
  </footer>

<script>
  const EXEC_URL = 'https://script.google.com/macros/s/AKfycbxEHXreFLXPTRzpnbU4Zzhz09iLXD9TyzxSyeTFfz6vzXLXzJdHcisLpHEHKH3U35K36w/exec';

  function loadJSONP() {
    const s = document.createElement('script');
    s.src = `${EXEC_URL}?format=jsonp&callback=renderReport&t=${Date.now()}`;
    s.defer = true;
    document.head.appendChild(s);
  }
  document.getElementById('refreshBtn').addEventListener('click', ()=>{
    // Clear previous JSONP tags to avoid piling up
    [...document.querySelectorAll('script[src*="/exec?"]')].forEach(n=>n.remove());
    loadJSONP();
  });
  function dismissBanner(){
    document.getElementById('sevBanner').style.display='none';
    localStorage.setItem('rw-banner-dismissed','1');
  }
  loadJSONP();

  function renderReport(report){
    document.title = report.meta.runTitle || 'Ripley Weather â€¢ Dashboard';
    document.getElementById('runTitle').textContent = report.meta.runTitle || 'Ripley Weather';
    document.getElementById('runStamp').textContent = `${report.meta.runTime} â€¢ #${report.meta.totalToday}`;

    document.getElementById('quickHtml').innerHTML     = report.quick;
    document.getElementById('cardsHtml').innerHTML     = report.cards;
    document.getElementById('sevenHtml').innerHTML     = report.sevenDay;
    document.getElementById('plannerHtml').innerHTML   = report.hourly;
    document.getElementById('trendsHtml').innerHTML    = report.trends;
    document.getElementById('severeHtml').innerHTML    = report.severe;
    document.getElementById('radarHtml').innerHTML     = report.radar;
    document.getElementById('lightningHtml').innerHTML = report.lightning;
    document.getElementById('alertsHtml').innerHTML    = report.alerts;
    document.getElementById('airHtml').innerHTML       = report.air;
    document.getElementById('localHtml').innerHTML     = report.local;
    document.getElementById('riversHtml').innerHTML    = report.rivers;
    document.getElementById('recordsHtml').innerHTML   = report.records;
    document.getElementById('astroHtml').innerHTML     = report.astro;
    document.getElementById('bottomHtml').innerHTML    = report.bottom;

    document.getElementById('lastUpdated').textContent =
      `Last updated: ${report.meta.runTime} â€¢ Reports today: ${report.meta.totalToday}`;

    // show banner if alerts present and not dismissed
    const sevActive = !!report.meta.severeActive;
    const dismissed = localStorage.getItem('rw-banner-dismissed') === '1';
    document.getElementById('sevBanner').style.display =
      (sevActive && !dismissed) ? 'block' : 'none';
  }
</script>
</body>
</html>
