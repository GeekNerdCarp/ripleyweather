<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ripley Weather • Dashboard</title>
<style>
  /* NOAA Classic (royal blue / red / white) */
  :root{
    --bg:#0d2242; --bg2:#07162e;
    --panel:#0f2e5a; --panel2:#12396e;
    --border:#1850a8; --white:#f7fbff;
    --red:#d62b2b; --gold:#fff6c7;
    --link:#bfe5ff; --linkh:#e6f6ff;
  }
  [data-theme="retro"]{ --bg:#001028; --bg2:#000a1a; --panel:#05213d; --panel2:#0b2e55; --border:#0e5aa8; --link:#9ad5ff; --linkh:#d2f1ff; }
  [data-theme="severe"]{ --red:#ff3b3b; }

  html,body{height:100%}
  body{
    margin:0; color:var(--white);
    background:linear-gradient(180deg,var(--bg),var(--bg2) 70%);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
  }
  a{color:var(--link)} a:hover{color:var(--linkh);text-decoration:underline}

  header{
    position:sticky; top:0; z-index:1000;
    background:linear-gradient(180deg,var(--panel2),var(--panel));
    border-bottom:6px solid var(--red);
    padding:10px 14px; display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;border-radius:6px;background:#0a3f7d;display:grid;place-items:center;box-shadow:inset 0 0 0 3px #d9e9ff}
  .logo b{color:var(--gold)}
  .title{font-weight:800;letter-spacing:.2px}

  .controls{display:flex;gap:8px}
  select,button{background:#0a2a54;color:var(--white);border:1px solid var(--border);border-radius:8px;padding:6px 10px}
  button{cursor:pointer}
  .spinner{display:inline-block;width:12px;height:12px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin .9s linear infinite;margin-left:6px}
  @keyframes spin{to{transform:rotate(360deg)}}

  .wrap{max-width:1000px;margin:14px auto;padding:0 12px}
  .card{background:linear-gradient(180deg,var(--panel2),var(--panel));
        border:2px solid var(--border); border-radius:14px; margin:12px 0; box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .bar{padding:10px 14px; background:linear-gradient(180deg,var(--panel2),#0e2b53);
       border-bottom:3px solid var(--red); color:var(--gold); font-weight:900; letter-spacing:.3px; display:flex;align-items:center;gap:10px}
  .body{padding:14px 16px}
  ul{margin:0 0 0 1.1em} li+li{margin-top:8px}

  table{width:100%;border-collapse:collapse}
  thead th{background:#0f3f86;color:#fffbe2;padding:8px 10px}
  td{border-top:1px solid #1a4f9e;padding:8px 10px}

  .sevBanner{
    position:sticky; top:0; z-index:1200;
    text-align:center; font-weight:900; color:#fff;
    padding:6px 10px; background:repeating-linear-gradient(45deg,#8a0000,#8a0000 12px,#d00000 12px,#d00000 24px);
    border-bottom:5px solid #ffd54f;
    display:none;
  }
</style>
</head>
<body data-theme="noaa">
  <header>
    <div class="brand">
      <div class="logo"><b>WX</b></div>
      <div class="title" id="runTitle">Ripley Weather</div>
    </div>
    <div class="controls">
      <select id="themePicker">
        <option value="noaa">NOAA Classic</option>
        <option value="retro">Retro ’90s</option>
        <option value="severe">Severe Mode (manual)</option>
      </select>
      <button id="refreshBtn">Refresh<span id="spin" class="spinner" style="display:none"></span></button>
    </div>
  </header>

  <div id="sevAuto" class="sevBanner">⚠️ Severe Weather Currently in the Area</div>

  <div class="wrap">
    <div class="card"><div class="bar">🔎 Quick Look</div><div class="body" id="quickHtml">Loading…</div></div>
    <div class="card"><div class="bar">📋 Key Cards</div><div class="body" id="cardsHtml">Loading…</div></div>
    <div class="card"><div class="bar">📆 7-Day Outlook</div><div class="body" id="sevenHtml">Loading…</div></div>
    <div class="card"><div class="bar">🕒 24-Hour Planner</div><div class="body" id="plannerHtml">Loading…</div></div>
    <div class="card"><div class="bar">📈 Trends & Diagnostics</div><div class="body" id="trendsHtml">Loading…</div></div>
    <div class="card"><div class="bar">⛈ Severe Weather</div><div class="body" id="severeHtml">Loading…</div></div>
    <div class="card"><div class="bar">🛰 Radar & Satellite</div><div class="body" id="radarHtml">Loading…</div></div>
    <div class="card"><div class="bar">⚡ Lightning</div><div class="body" id="lightningHtml">Loading…</div></div>
    <div class="card"><div class="bar">⚠️ Alerts & Hazards</div><div class="body" id="alertsHtml">Loading…</div></div>
    <div class="card"><div class="bar">🌬 Air & Health</div><div class="body" id="airHtml">Loading…</div></div>
    <div class="card"><div class="bar">🏫 Local Impacts</div><div class="body" id="localHtml">Loading…</div></div>
    <div class="card"><div class="bar">🌊 Rivers & Streams</div><div class="body" id="riversHtml">Loading…</div></div>
    <div class="card"><div class="bar">📊 Climatology & Records</div><div class="body" id="recordsHtml">Loading…</div></div>
    <div class="card"><div class="bar">🌌 Astronomy & Skywatch</div><div class="body" id="astroHtml">Loading…</div></div>
    <div class="card"><div class="bar">✅ Bottom Line</div><div class="body" id="bottomHtml">Loading…</div></div>
    <div class="card"><div class="bar">📝 Area Forecast Discussion (AFD)</div>
      <div class="body">Full text hosted at NWS: <a id="afdLink" href="#" target="_blank" rel="noopener">Open ILN AFD</a></div>
    </div>
    <div class="card"><div class="bar">ℹ️ Sources & Credits</div>
      <div class="body">
        <p><strong>Created by Matthew Carpenter</strong> • <a href="mailto:matthew@carpsemail.com">matthew@carpsemail.com</a></p>
        <ul>
          <li>NOAA / NWS: 7-Day, alerts, AFD</li>
          <li>Open-Meteo: current/hourly/daily</li>
          <li>AirNow: AQI (PM2.5 / O<sub>3</sub>)</li>
          <li>Meteostat (RapidAPI): daily records</li>
          <li>LightningMaps.org, NOAA Satellite (links)</li>
        </ul>
      </div>
    </div>
  </div>

<script>
  const EXEC_URL = 'https://script.google.com/macros/s/AKfycbxEHXreFLXPTRzpnbU4Zzhz09iLXD9TyzxSyeTFfz6vzXLXzJdHcisLpHEHKH3U35K36w/exec';

  // Theme picker (persist)
  const pick = document.getElementById('themePicker');
  function applyTheme(v){ document.body.setAttribute('data-theme', v); localStorage.setItem('wx_theme', v); }
  applyTheme(localStorage.getItem('wx_theme') || 'noaa');
  pick.value = localStorage.getItem('wx_theme') || 'noaa';
  pick.addEventListener('change', e=>applyTheme(e.target.value));

  // Refresh
  const btn = document.getElementById('refreshBtn'), spin = document.getElementById('spin');
  btn.addEventListener('click', ()=>{ btn.disabled=true; spin.style.display='inline-block'; load(true); });

  function renderReport(r){
    document.getElementById('runTitle').textContent = r.meta?.runTitle || 'Ripley Weather';

    const map = {
      quickHtml:'quick', cardsHtml:'cards', sevenHtml:'sevenDay', plannerHtml:'hourly',
      trendsHtml:'trends', severeHtml:'severe', radarHtml:'radar', lightningHtml:'lightning',
      alertsHtml:'severe', airHtml:'air', localHtml:'local', riversHtml:'rivers',
      recordsHtml:'records', astroHtml:'astro', bottomHtml:'bottom'
    };
    Object.entries(map).forEach(([id,key])=>{
      const el = document.getElementById(id); if(el) el.innerHTML = r[key] || '—';
    });
    if (r.afdLink) document.getElementById('afdLink').href = r.afdLink;

    document.getElementById('sevAuto').style.display = r.alertsActive ? 'block' : 'none';

    spin.style.display='none'; btn.disabled=false;
  }

  function load(bust){
    const s=document.createElement('script');
    s.src = `${EXEC_URL}?format=jsonp&callback=renderReport${bust?('&t='+Date.now()):''}`;
    s.defer=true; document.head.appendChild(s);
  }
  load(false);
</script>
</body>
</html>
