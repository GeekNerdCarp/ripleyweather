<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ripley Weather ‚Ä¢ Dashboard</title>

<style>
  :root{
    --bg: #0c1e36; --panel:#0f2747; --panel-top:#123059;
    --border:#1a4c80; --glow:#0a1a2e; --text:#eaf5ff; --muted:#c8d8ee;
    --accent:#8bd0ff; --accent-2:#ff4455; --accent-3:#fffbd1;
    --chip:#0e61a8; --link:#9cd7ff; --link-h:#c7ecff;
    --banner:#0b3566; --banner-grad:#0b4a86;
  }
  /* NOAA Classic theme (default) */
  [data-theme="noaa"]{
    --bg:#0c1e36; --panel:#0f2747; --panel-top:#0f305f;
    --border:#1b4e86; --accent:#6cc6ff; --accent-2:#ff2d3a; --accent-3:#fffbd1;
  }
  /* Retro ‚Äô90s (your previous) */
  [data-theme="retro"]{
    --bg:#00102a; --panel:#0b1c33; --panel-top:#0d243f;
    --border:#0f4f85; --accent:#8bd0ff; --accent-2:#ff5a7a; --accent-3:#fffbd1;
  }
  /* Severe Mode (kept for manual toggle, auto still uses alert flag) */
  [data-theme="severe"]{
    --banner:#5b0000; --banner-grad:#9e0415; --accent-2:#ff4455;
  }

  html,body{height:100%}
  body{
    margin:0;background:linear-gradient(180deg, var(--bg) 0%, #061225 100%);
    color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
  }
  a{color:var(--link); text-decoration:none} a:hover{color:var(--link-h); text-decoration:underline}

  header{
    position:sticky; top:0; z-index:1000;
    background:linear-gradient(180deg, var(--banner-grad), var(--banner));
    border-bottom:4px solid var(--border);
    padding:10px 14px; display:flex; align-items:center; gap:12px; justify-content:space-between;
  }
  .left{display:flex; align-items:center; gap:10px}
  .logo{width:34px;height:34px;border-radius:6px;background:#0a437a;display:grid;place-items:center;
        box-shadow: inset 0 0 0 2px #cddff7, inset 0 0 16px rgba(255,255,255,.15)}
  .logo b{color:#fffbd1}
  .title{font-weight:800; letter-spacing:.3px}

  .controls{display:flex; gap:8px; align-items:center}
  select, button{
    background:#0a2a4d; color:var(--text);
    border:1px solid var(--border); border-radius:8px; padding:6px 10px;
  }
  button{cursor:pointer}
  .spinner{display:inline-block;width:12px;height:12px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 0.9s linear infinite;margin-left:6px}
  @keyframes spin{to{transform:rotate(360deg)}}

  .wrap{max-width:1100px;margin:14px auto;padding:0 12px}
  .card{background:linear-gradient(180deg, var(--panel-top), var(--panel));
        border:2px solid var(--border); border-radius:14px; margin:12px 0; box-shadow:0 8px 20px rgba(0,0,0,.25)}
  .bar{padding:10px 14px; background:linear-gradient(180deg, var(--panel-top), #0c2a52);
       border-bottom:2px solid var(--border); color:var(--accent-3); font-weight:800; display:flex; align-items:center; gap:10px}
  .body{padding:12px 16px}
  .severe-banner{
    position:sticky; top:0; z-index:1100; text-align:center; font-weight:900; color:#fff;
    padding:6px 10px; background:repeating-linear-gradient(45deg, #7e0000, #7e0000 12px, #c40000 12px, #c40000 24px);
    border-bottom:4px solid #ffdb4d; animation:pulse 1.2s ease-in-out infinite;
  }
  @keyframes pulse{0%{filter:saturate(1)}50%{filter:saturate(1.4)}100%{filter:saturate(1)}}

  .two-col{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media(max-width:900px){.two-col{grid-template-columns:1fr}}
  ul{margin:0 0 0 1.1em}
  li+li{margin-top:8px}

  /* 7-day table */
  table{width:100%; border-collapse:collapse}
  thead th{background:#0c3e73; color:#fffbd1; padding:8px 10px}
  td{border-top:1px solid var(--border); padding:8px 10px}
</style>
</head>
<body data-theme="noaa">
  <header>
    <div class="left">
      <div class="logo"><b>WX</b></div>
      <div class="title" id="runTitle">Ripley Weather</div>
    </div>
    <div class="controls">
      <select id="themePicker" title="Theme">
        <option value="noaa">NOAA Classic</option>
        <option value="retro">Retro ‚Äô90s</option>
        <option value="severe">Severe Mode</option>
      </select>
      <button id="refreshBtn">Refresh<span id="spin" style="display:none" class="spinner"></span></button>
    </div>
  </header>

  <div id="autoSevere" class="severe-banner" style="display:none;">‚ö†Ô∏è Severe Weather Currently in the Area</div>

  <div class="wrap">
    <div class="card">
      <div class="bar">üîé Quick Look</div>
      <div class="body" id="quickHtml">Loading‚Ä¶</div>
    </div>

    <div class="card">
      <div class="bar">üìã Key Cards</div>
      <div class="body" id="cardsHtml">Loading‚Ä¶</div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">üìÜ 7-Day Outlook</div>
        <div class="body" id="sevenHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">üïí 24-Hour Planner</div>
        <div class="body" id="plannerHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">üìà Trends & Diagnostics</div>
        <div class="body" id="trendsHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">‚õà Severe Weather</div>
        <div class="body" id="severeHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">üõ∞ Radar & Satellite</div>
        <div class="body" id="radarHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">‚ö° Lightning</div>
        <div class="body" id="lightningHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">‚ö†Ô∏è Alerts & Hazards</div>
        <div class="body" id="alertsHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">üå¨ Air & Health</div>
        <div class="body" id="airHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">üè´ Local Impacts</div>
        <div class="body" id="localHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">üåä Rivers & Streams</div>
        <div class="body" id="riversHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="two-col">
      <div class="card">
        <div class="bar">üìä Climatology & Records</div>
        <div class="body" id="recordsHtml">Loading‚Ä¶</div>
      </div>
      <div class="card">
        <div class="bar">üåå Astronomy & Skywatch</div>
        <div class="body" id="astroHtml">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="card">
      <div class="bar">‚úÖ Bottom Line</div>
      <div class="body" id="bottomHtml">Loading‚Ä¶</div>
    </div>

    <div class="card">
      <div class="bar">üìù Area Forecast Discussion (AFD)</div>
      <div class="body">
        Full text hosted at NWS: <a id="afdLink" href="#" target="_blank" rel="noopener">Open ILN AFD</a>
      </div>
    </div>

    <div class="card">
      <div class="bar">‚ÑπÔ∏è Sources & Credits</div>
      <div class="body">
        <p><strong>Created by Matthew Carpenter</strong> ‚Ä¢ <a href="mailto:matthew@carpsemail.com">matthew@carpsemail.com</a></p>
        <ul>
          <li>NOAA / NWS: 7-Day, alerts, AFD</li>
          <li>Open-Meteo: hourly/current/daily core data</li>
          <li>AirNow: AQI (PM2.5 / O<sub>3</sub>)</li>
          <li>Meteostat (RapidAPI): daily records</li>
          <li>LightningMaps.org, NOAA Satellite (links)</li>
        </ul>
      </div>
    </div>
  </div>

<script>
  const EXEC_URL = 'https://script.google.com/macros/s/AKfycbxEHXreFLXPTRzpnbU4Zzhz09iLXD9TyzxSyeTFfz6vzXLXzJdHcisLpHEHKH3U35K36w/exec';

  // ‚Äî Theme Picker ‚Äî //
  const $root = document.documentElement;
  const picker = document.getElementById('themePicker');
  function applyTheme(v){ document.body.setAttribute('data-theme', v||'noaa'); localStorage.setItem('wx_theme', v||'noaa'); }
  picker.addEventListener('change', e => applyTheme(e.target.value));
  applyTheme(localStorage.getItem('wx_theme') || 'noaa');
  picker.value = localStorage.getItem('wx_theme') || 'noaa';

  // ‚Äî Refresh ‚Äî //
  const btn = document.getElementById('refreshBtn');
  const spin = document.getElementById('spin');
  btn.addEventListener('click', () => { spin.style.display='inline-block'; btn.disabled=true; loadReport(true); });

  function renderReport(r){
    document.getElementById('runTitle').textContent = r.meta.runTitle || 'Ripley Weather';
    document.getElementById('quickHtml').innerHTML     = r.quick;
    document.getElementById('cardsHtml').innerHTML     = r.cards;
    document.getElementById('sevenHtml').innerHTML     = r.sevenDay;
    document.getElementById('plannerHtml').innerHTML   = r.hourly;
    document.getElementById('trendsHtml').innerHTML    = r.trends;
    document.getElementById('severeHtml').innerHTML    = r.severe;
    document.getElementById('radarHtml').innerHTML     = r.radar;
    document.getElementById('lightningHtml').innerHTML = r.lightning;
    document.getElementById('alertsHtml').innerHTML    = r.severe;
    document.getElementById('airHtml').innerHTML       = r.air;
    document.getElementById('localHtml').innerHTML     = r.local;
    document.getElementById('riversHtml').innerHTML    = r.rivers;
    document.getElementById('recordsHtml').innerHTML   = r.records;
    document.getElementById('astroHtml').innerHTML     = r.astro;
    document.getElementById('bottomHtml').innerHTML    = r.bottom;
    if (r.afdLink) document.getElementById('afdLink').href = r.afdLink;

    // Auto-severe banner
    document.getElementById('autoSevere').style.display = r.alertsActive ? 'block' : 'none';

    // Reset refresh button state
    spin.style.display='none'; btn.disabled=false;
  }

  function loadReport(bust){
    const s = document.createElement('script');
    const ts = Date.now();
    s.src = `${EXEC_URL}?format=jsonp&callback=renderReport${bust?'&nocache='+ts:''}`;
    s.defer = true;
    document.head.appendChild(s);
  }
  loadReport(false);
</script>
</body>
</html>
